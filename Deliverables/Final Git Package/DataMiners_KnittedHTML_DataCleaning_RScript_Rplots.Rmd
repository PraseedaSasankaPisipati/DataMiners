
## R Markdown

---
title: "R Plot"
author: "Team Data Miners"
date: "12/3/2017"
---

## Group Members
1. Praseeda Sasanka
2. Sowjanya
3. Zahra Hatami

# Information of Data Set
The data is colleted from center for desieas control prevention (CDC). This data set was collected for the years 2005-2015. Mortality data for U.S. residents come from the National Vital Statistics System. Estimates are based on fewer than 10 observed deaths are not shown and are shaded yellow on the map. Underlying cause of death is based on the International Classification of Diseases, 10th Revision (ICD-10). The data consists of 20,5921 rows and 13 columns.

With analyzing this data and finding differences between Expected Deaths and Observed Deaths, health care can be improved by public health programs that support healthier behaviors to better access the health care services for the purpose of reducing the rate of potentially excess deaths.

## License
The License details for the Excess Deaths Data Set can be found in License Info
There are no constraints on this data in regards to the license. This is public data set and can be downloaded by any individual within or outside the organization.

[License Info](https://www.cms.gov/about-cms/agency-information/aboutwebsite/privacy-policy.html)

## Data Cleaning:
This data represented the percentage of expected death, observed deaths and potential death in different states in the United States. All data is collected based on five leading causes of death in metropolitan and non-metropolitan areas. Heart disease, Cancer, Unintentional injury, Chronic lower respiratory disease and Stroke are the major causes of death that patients are spending so much money for any treatment for them. The data consists of 20,5921 rows and 13 columns.

## Metadata
This data set was collected for the years 2005-2015
**Mortality** data for U.S. residents come from the National Vital Statistics System. Estimates based on fewer than 10 observed deaths are not shown and shaded yellow on the map.

**Underlying cause of death** is based on the International Classification of Diseases, 10th Revision (ICD-10)

Heart disease (I00-I09, I11, I13, and I20-I51)
Cancer (C00-C97)
Unintentional injury (V01-X59 and Y85-Y86)
Chronic lower respiratory disease (J40-J47)
Stroke (I60-I69)

**Locality** (nonmetropolitan vs. metropolitan) is based on the Office of Management and Budget's 2013 county-based classification scheme.

**Benchmarks** are based on the three states with the lowest age and cause-specific mortality rates.

**Potentially excess deaths** for each state are calculated by subtracting deaths at the benchmark rates (expected deaths) from observed deaths.

Users can explore three benchmarks:  

"2010 Fixed" is a fixed benchmark based on the best performing States in 2010.  
"2005 Fixed" is a fixed benchmark based on the best performing States in 2005.  
"Floating" is based on the best performing States in each year so change from year to year.  

_Page last reviewed_: July 14, 2017  
_Page last updated_ : August 28, 2017
 
## Strategies for Data Cleaning
_Steps/Strategies for cleaning data_:
1. Analyzed the research questions and identified the required columns for analysis of Excess Deaths data set  
2. Reviewed the format of the column values in the data set to understand which command in R will be more effective to be used for this format  
3. The summary of data was obtained using R to get an overall view of the data  
4. Performed a check for missing data and found all missing data. Replaced all missing data with "NA"  
5. Tried to figure out how can we deal missing value like deleting the observations, deleting the variable, prediction or imputation with mean/median/mode. By keen observation of the data, decision was taken to delete the observations as the incomplete data cannot be of much use for the analysis. There are enormous number of observations in the data set, where all the classifications are sufficiently represented in the data. For example, having the details of locality, age, cause of death without the metrics like Expected Deaths, Potentially Excess Deaths is of not much use for analysis  
6. Checked the format of the data set to see which kind of command is needed to use in R and executed those commands in R Studio  
7. We also found few duplicate values in the data set and deleted them using R command

## Issues during Data Cleaning
Below are the issues faced during cleaning the data set
1. As this was the first time, all the team members are using R for data analysis, it took us time to get familiar with R. For example, creation of block for the code to run and closing the block before running the code  
2. Another issue was, we had the age range as 0-59, 0-64, 0-74 and so on but with the same locality, state and year. Initially, the team felt this might be redundant data. But later, when we looked at the total population values, the numbers kept increasing for each range. So, we finally reviewed the description of the data in the CDC website and understood that the age ranges were always kept at standard minimum value '0'. As there is no redundancy we didn't delete any data.  
3. Deciding on which method to follow for the missing data was not an easy task. It consumed a lot of time too. 


## License Information of GitHub Repository
MIT License

Copyright (c) 2017 PraseedaSasankaPisipati

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.


##### **The Research Questions had been modified based on the comments given for the previous assignments as below:**

1. What is the trend of observed deaths for all the five leading cause of deaths over time?

2. What is the trend of expected deaths,observed deaths, potentially excess 
deaths in each age group?

3. Compare the number of deaths for various regions of US. Which region has the maximum and minimum number of deaths recorded for the years 2005 to 2015?

4. Compare the number of deaths for each locality. Which locality has the maximum and minumum number of deaths recorded for the years 2005 to 2015?

5. What is the ratio between the observed deaths and the Population? What is the trend of the ratio over time by region?

6. What is the ratio between the expected deaths and the Population? What is the trend of the ratio over time by region?

7. Are the ratios in questions 5 and 6 correlated?


### R Script for Data Cleaning
```{r echo=FALSE, warning=FALSE}

NCHS_New1 <- read.csv("NCHS.csv")


aft_mis_NCHS_New1<-na.omit(NCHS_New1)


aft_mis_NCHS_New2<- aft_mis_NCHS_New1[!(aft_mis_NCHS_New1$State == "United States"),]

aft_mis_NCHS_New3<- aft_mis_NCHS_New2[!(aft_mis_NCHS_New2$Locality == "All"),]

dat <- aft_mis_NCHS_New3


library(noncensus)

data("states")


Reg <- states[,c(1,3)]


Health_data <- merge(dat,Reg,by.x = "State.FIPS.Code",by.y = "state")


### write.csv(Health_data,"Health data1.csv")
```
## R Script to generate R Plots

### 1.Trend of all the five leading cause of Observed deaths over time for each region
```{r Data_allNew, echo=FALSE, warning= FALSE}
Data_all <- Health_data[,c(2:3,9,14)]


suppressMessages(library(dplyr))

Data_allNew <- Data_all  %>%
  group_by(region, Year, Cause.of.Death) %>%
  summarise_all(funs(mean))


suppressMessages(library(ggplot2))

ggplot(data = Data_allNew, aes(x=Year, y = Observed.Deaths, colour = region, group = region)) + labs(title="Trend of Observed Deaths by Year", x="Year",y="Observed Deaths") +
  geom_line()+scale_x_continuous(breaks=seq(2005, 2015, 3)) + facet_wrap(~Cause.of.Death,scales = "free_y")
```


This plot provides the overview of trend for the five leading cause of deaths (observed deaths) over time. From the plot we could see that "Cancer" has the highest number of deaths and that is in the southern region of United States. The lower number of deaths could be seen for "Stroke" in the western region of United States. The order of the trends in descending order are Cancer, Heart Disease, Unintentional Injury, Chronic Lower Respiratory Disease, Stroke.  

### 2. Trend of all types of deaths in Each age group
```{r long_data_sec_New, echo=FALSE, warning=FALSE}
Data_sec <- Health_data[,c(3,6,9,11,12)]

library(dplyr)
Data_sec_New <- Data_sec  %>%
  group_by(Age.Range, Cause.of.Death) %>%
  summarise_all(funs(mean))


library(tidyr)
long_data_sec_New <- gather(Data_sec_New,"Death_Type", "Deaths", Observed.Deaths, Expected.Deaths, Potentially.Excess.Deaths)

library(ggplot2)
ggplot(data = long_data_sec_New, aes(x=factor(Age.Range), y = Deaths, colour = Death_Type, group = Death_Type)) + labs(title="Trend of Deaths by Age Group", x="Age Group",y=" Number of Deaths") + 
  geom_line() + facet_wrap(~Cause.of.Death,scales = "free")+ theme(axis.text=element_text(size=5))
```


This plot provides the trend of all types of deaths for each age group. In this plot we could see that the observed deaths are always greater than the expected deaths. As the age increases the numbers of deaths kept increasing. This behavior is consistent for all the causes of death.

## 3. Comparison of all types of Deaths by region
```{r long_data_region, echo=FALSE, warning=FALSE}
library(dplyr)

Data_region <- Health_data[,c(9,11,12,14)] %>%
  group_by(region) %>%
  summarise_all(funs(mean))

library(tidyr)

long_data_region <- gather(Data_region,"Death_Type", "Avg_Deaths", Observed.Deaths, Expected.Deaths, Potentially.Excess.Deaths)

library(ggplot2)

ggplot(long_data_region,aes(x = region,y = Avg_Deaths,fill = Death_Type)) + labs(title="Trend of Average of Deaths by Region", x="Region",y="Mean of Deaths") + geom_bar(position = "dodge", stat = "identity")
```


This plot gives the mean of all the deaths over various regions. The observed deaths are more in the southern part of the United States followed by Northeast, Midwest and West. The Expected Deaths average is almost equal in both South and Northeast. Midwest and West also have equal averages but lower than South and Northeast. South region also has the maximum average for potentially excess deaths followed by Midwest, Northeast and West

## 4. Comparison of all types of Deaths by locality
```{r long_Data_Locality, echo=FALSE, warning=FALSE}
library(dplyr)

Data_Locality <- Health_data[,c(8,9,11,12)] %>%
  group_by(Locality) %>%
  summarise_all(funs(mean))

library(tidyr)

long_Data_Locality <- gather(Data_Locality,"Death_Type", "Avg_Deaths", Observed.Deaths, Expected.Deaths, Potentially.Excess.Deaths)

library(ggplot2)

ggplot(long_Data_Locality,aes(x = Locality,y = Avg_Deaths,fill = Death_Type)) + labs(title="Trend of Average of Deaths by Locality", x="Region",y="Mean of Deaths") + geom_bar(position = "dodge", stat = "identity")
```


This plot provides the means of all the deaths by locality. For all the death parameters the highest and lowest are consistent which are found in All localities and Non-Metropolitan.

## 5. Ratio of observed deaths and population over various regions
```{r Obs.Deaths_region, echo=FALSE, warning=FALSE}
Health_data$percent_obs.deaths <- (Health_data$Observed.Deaths / Health_data$Population) * 100

Obs.Deaths_region <- Health_data[,c(14:15)] %>%
  group_by(region) %>%
  summarise_all(funs(mean))

library(ggplot2)

ggplot(Obs.Deaths_region,aes(x = region,y = percent_obs.deaths,fill = region)) + labs(title="Trend of Observed Deaths percentage", x="Region",y="Observed Deaths/Population") + geom_bar(stat = "identity")
```



This plot provides the fact that the observed deaths percentage is found highest in the Northeast and the lowest in West. Based on different regions (Midwest, Northeast, West and South) in the united states, the average for Observed deaths in south of united states is larger than other regions and so percentage of observed deaths in south of united states is more than other regions.

## 6. Ratio of Expected Deaths to Population over regions
```{r exp.Deaths_region, Obs.Deaths_region, echo=FALSE, warning=FALSE}
Health_data$percent_exp.deaths <- (Health_data$Expected.Deaths / Health_data$Population) * 100
Health_data$percent_obs.deaths <- (Health_data$Observed.Deaths / Health_data$Population) * 100

exp.Deaths_region <- Health_data[,c(14,16)] %>%
  group_by(region) %>%
  summarise_all(funs(mean))

library(ggplot2)

ggplot(exp.Deaths_region,aes(x = region,y = percent_exp.deaths,fill = region)) + labs(title="Trend of Expected Deaths percentage", x="Region",y="Expected Deaths/Population")+ geom_bar(stat = "identity")
```



This plot is between ratio of expected deaths to population over regions. The expected death in northeast has highest rate compared with other regions. So even the expected death in northeast is greater than other regions. But as observed deaths in south of the united states is much greater than other regions, the potentially excess deaths (difference between expected death and observed death) in south of America is greater than other regions.

## 7. Correlation between both the ratios in Questions 5 and 6
```{r Obs.Deaths_region3, echo=FALSE}
cor(Health_data$percent_obs.deaths,Health_data$percent_exp.deaths)
```

#### **There is a Positive correlation of 0.9469511 between the two ratios**
There is a 0.94 correlation between the two ratios which means that the ratios are in sync for 94% of the records. 
But the ratios recorded a non-corrleation i.e one ratio increased and the other ratio decreased in 6% of the cases. This indicates that the projected expected deaths are accurate. The criteria considered for projecting the death rates is reliable.

### R Script Link
Below is the link to R Script which can be executed to generate the plots
[R Script Link](https://github.com/PraseedaSasankaPisipati/DataMiners/blob/master/Deliverables/R%20Plots/Rplot_Rscript.R)
